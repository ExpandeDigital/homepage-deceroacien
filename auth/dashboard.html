<!DOCTYPE html>
<html lang="es">
<head>
    <!-- Meta tags esenciales para SEO y responsividad -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Dashboard de usuario - DE CERO A CIEN">
    <meta name="keywords" content="dashboard, usuario, DE CERO A CIEN">
    <meta name="author" content="DE CERO A CIEN">
    
    <!-- T√≠tulo de la p√°gina -->
    <title>Mi Dashboard - DE CERO A CIEN</title>
    
    <!-- Meta tags para redes sociales -->
    <meta property="og:title" content="Dashboard - DE CERO A CIEN">
    <meta property="og:description" content="Accede a tus herramientas y recursos personalizados.">
    <meta property="og:url" content="https://deceroacien.app/auth/dashboard.html">
    <meta name="twitter:card" content="summary_large_image">
    
    <!-- Preload de recursos cr√≠ticos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="preload" href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" as="style">
    
    <!-- Favicon -->
    <link rel="icon" href="/assets/logo_de_cero_a_cien_blanco_y_dorado.png" type="image/png">

    <!-- Hojas de estilo -->
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/styles/common.css">
    <link rel="stylesheet" href="../assets/styles/mobile.css">
    
    <!-- Configuraci√≥n de Tailwind personalizada -->
<!-- Firebase cargado de forma centralizada por assets/js/components.js -->
</head>
<body class="base-container antialiased">

    <!-- HEADER UNIFICADO -->
    <header class="header-component"></header>

    <!-- CONTENIDO PRINCIPAL -->
    <main class="main-content">
        <!-- Welcome Section -->
        <section class="main-section py-12">
            <div class="section-container">
                <div class="flex items-center justify-between flex-wrap gap-4">
                    <div>
                        <h1 class="text-3xl sm:text-4xl font-bold text-white">
                            ¬°Bienvenido de vuelta, <span id="userName" class="highlight-text">Usuario</span>!
                        </h1>
                        <p class="mt-2 text-gray-400">Aqu√≠ tienes acceso a todas tus herramientas y recursos.</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div id="userProfile" class="flex items-center gap-3">
                            <img id="userAvatar" src="../assets/avatar_ignacio.jpg" alt="Avatar" class="w-12 h-12 rounded-full border-2 border-yellow-400">
                            <div class="hidden sm:block">
                                <p id="userEmail" class="text-sm text-gray-300">email@example.com</p>
                                <p id="userCompany" class="text-xs text-gray-400">Empresa</p>
                            </div>
                        </div>
                        <!-- Selector de avatar gen√©rico cuando no hay foto de Google -->
                        <div id="avatarSelector" class="hidden sm:flex items-center gap-2 text-xs text-gray-300">
                            <span>Avatar:</span>
                            <button type="button" data-avatar="male" class="px-2 py-1 border border-gray-600 rounded hover:bg-gray-700">Masculino</button>
                            <button type="button" data-avatar="female" class="px-2 py-1 border border-gray-600 rounded hover:bg-gray-700">Femenino</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Quick Actions -->
        <section class="main-section pb-12">
            <div class="section-container">
                <h2 class="text-2xl font-bold text-white mb-6">Acciones R√°pidas</h2>
                <div class="responsive-grid lg:grid-cols-5 gap-4">
                    <a href="../camino-dorado.html" class="card-component text-center hover:scale-105 transition-transform">
                        <div class="text-3xl mb-3">üèÜ</div>
                        <h3 class="text-lg font-semibold text-white">El Camino Dorado</h3>
                        <p class="text-sm text-gray-400 mt-1">Accede a las 31 herramientas</p>
                    </a>
                    
                    <a href="../de_cero_a_cien.html" class="card-component text-center hover:scale-105 transition-transform">
                        <div class="text-3xl mb-3">üöÄ</div>
                        <h3 class="text-lg font-semibold text-white">De Cero a Cien</h3>
                        <p class="text-sm text-gray-400 mt-1">Transforma tu idea en negocio</p>
                    </a>
                    
                    <a href="../portal-alumno.html" class="card-component text-center hover:scale-105 transition-transform">
                        <div class="text-3xl mb-3">üìö</div>
                        <h3 class="text-lg font-semibold text-white">Portal del Alumno</h3>
                        <p class="text-sm text-gray-400 mt-1">Herramientas por fases</p>
                    </a>
                    
                    <a href="../academy-fases/index.html" class="card-component text-center hover:scale-105 transition-transform">
                        <div class="text-3xl mb-3">üéì</div>
                        <h3 class="text-lg font-semibold text-white">Academy</h3>
                        <p class="text-sm text-gray-400 mt-1">Programas y Masterclasses</p>
                    </a>
                    
                    <a href="../comunidad/conecta.html" class="card-component text-center hover:scale-105 transition-transform">
                        <div class="text-3xl mb-3">ü§ù</div>
                        <h3 class="text-lg font-semibold text-white">Comunidad</h3>
                        <p class="text-sm text-gray-400 mt-1">Comunidad emprendedora</p>
                    </a>
                </div>
            </div>
        </section>

        <!-- Progress Section (din√°mica por demo-full-access.js) -->
        <section class="main-section pb-12">
            <div class="section-container">
                <h2 class="text-2xl font-bold text-white mb-6">Tu Progreso</h2>
                <div class="card-component" data-progress-dashboard>
                    <div class="text-gray-400 text-sm animate-pulse">Cargando progreso...</div>
                </div>
            </div>
        </section>

        <!-- Recent Activity -->
        <section class="main-section pb-12">
            <div class="section-container">
                <h2 class="text-2xl font-bold text-white mb-6">Actividad Reciente</h2>
                <div class="card-component" data-recent-activity>
                    <div class="text-gray-400 text-center py-8">
                        A√∫n no tienes actividad reciente. ¬°Comienza explorando nuestros programas y herramientas!
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- FOOTER UNIFICADO -->
    <footer class="footer-component"></footer>

    <!-- Scripts JavaScript -->
    <script src="../assets/js/config-secure.js"></script>
    <script src="../assets/js/supabase-client.js"></script>
    <script src="../assets/js/auth.js"></script>
    <!-- Script de modo demo full access (solo en rama feature/full-access-demo). Debe ir ANTES de components.js para que authManager ya tenga user -->
    <script src="../assets/js/demo-full-access.js"></script>
    <script src="../assets/js/tracking-demo.js"></script>
    <script src="../assets/js/components.js"></script>
    <script src="../assets/js/debug-auth.js"></script>
    <script>
        // Proteger esta p√°gina requiriendo autenticaci√≥n con una breve espera por sesi√≥n de Supabase
        async function waitForSupabaseSession(timeoutMs = 2000) {
            const start = Date.now();
            try { if (window.SupabaseAuth && window.SupabaseAuth.ensureSupabase) await window.SupabaseAuth.ensureSupabase(); } catch(_) {}
            while (Date.now() - start < timeoutMs) {
                try {
                    if (window.authManager && window.authManager.isUserAuthenticated && window.authManager.isUserAuthenticated()) return true;
                    if (window.SupabaseAuth && window.SupabaseAuth.getAccessToken) {
                        const t = await window.SupabaseAuth.getAccessToken();
                        if (t) return true;
                    }
                } catch(_) {}
                await new Promise(r => setTimeout(r, 150));
            }
            return !!(window.authManager && window.authManager.isUserAuthenticated && window.authManager.isUserAuthenticated());
        }

        document.addEventListener('DOMContentLoaded', async function() {
            // Espera breve para evitar condiciones de carrera al sincronizar sesi√≥n
            await waitForSupabaseSession(2000);
            if (!requireAuth()) {
                return;
            }
            // Cargar datos del usuario
            loadUserData();
        });

        function loadUserData() {
            if (authManager && authManager.isUserAuthenticated()) {
                const user = authManager.getCurrentUser();
                // Actualizar informaci√≥n del usuario en la p√°gina
                document.getElementById('userName').textContent = user.firstName || 'Usuario';
                document.getElementById('userEmail').textContent = user.email || '';
                document.getElementById('userCompany').textContent = user.company || 'Emprendedor';
                // Si el usuario tiene foto de perfil (Google), usarla
                const avatarEl = document.getElementById('userAvatar');
                const hasGooglePhoto = !!(user.profilePicture && /^https?:\/\//.test(user.profilePicture));
                if (user.profilePicture) {
                    avatarEl.src = user.profilePicture.startsWith('/') ? ('..' + user.profilePicture) : user.profilePicture;
                } else {
                    const pref = (localStorage.getItem('deceroacien_avatar_pref') || 'male').toLowerCase();
                    avatarEl.src = pref === 'female' ? '../assets/female-avatar.png' : '../assets/male-avatar.png';
                }
                // Mostrar selector solo si no hay foto de Google
                const sel = document.getElementById('avatarSelector');
                if (sel) {
                    sel.style.display = hasGooglePhoto ? 'none' : 'flex';
                    sel.querySelectorAll('button[data-avatar]').forEach(btn => {
                        btn.onclick = () => {
                            const choice = btn.getAttribute('data-avatar');
                            localStorage.setItem('deceroacien_avatar_pref', choice);
                            const newSrc = choice === 'female' ? '../assets/female-avatar.png' : '../assets/male-avatar.png';
                            avatarEl.src = newSrc;
                            // Actualizar en sesi√≥n actual
                            if (window.authManager && window.authManager.currentUser) {
                                window.authManager.currentUser.profilePicture = '/' + (choice === 'female' ? 'assets/female-avatar.png' : 'assets/male-avatar.png');
                                try {
                                    const key = (window.PublicAuthConfig && window.PublicAuthConfig.storage && window.PublicAuthConfig.storage.userKey) || 'deceroacien_user';
                                    localStorage.setItem(key, JSON.stringify(window.authManager.currentUser));
                                } catch(_) {}
                            }
                        };
                    });
                }
            }
        }
    </script>
</body>
</html>
