<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ConexiÃ³n en Vivo - De Cero a Cien</title>
    <meta name="description" content="Sala de espera para reuniones en vivo - De Cero a Cien">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    
    <!-- Estilos -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="assets/styles/waiting-room.css">
    
    <!-- Tailwind CSS (solo para utilidades adicionales) -->
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="waiting-room">

    <div class="container-card fade-in">
        <h1 id="meeting-title" class="font-serif text-3xl md:text-4xl font-bold text-white mb-2">
            Sala de Espera - ReuniÃ³n en Vivo
        </h1>
        <p class="status-message mb-4">
            SerÃ¡s redirigido automÃ¡ticamente cuando comience la reuniÃ³n
        </p>
        <p id="meeting-date" class="text-sm status-message mb-2">
            ðŸ“… Configurando horario de reuniÃ³n...
        </p>
        <p class="text-xs status-message mb-3">
            ðŸŒŽ Hora de inicio en cada paÃ­s:
        </p>
        
        <!-- Zonas horarias -->
        <div class="timezone-grid">
            <div class="timezone-item">
                <div class="text-xs font-semibold text-dorado">ðŸ‡ºðŸ‡¾ Montevideo</div>
                <div class="text-xs text-texto-secundario">--:-- --</div>
            </div>
            <div class="timezone-item">
                <div class="text-xs font-semibold text-dorado">ðŸ‡¨ðŸ‡± Santiago</div>
                <div class="text-xs text-texto-secundario">--:-- --</div>
            </div>
            <div class="timezone-item">
                <div class="text-xs font-semibold text-dorado">ðŸ‡¦ðŸ‡· Buenos Aires</div>
                <div class="text-xs text-texto-secundario">--:-- --</div>
            </div>
            <div class="timezone-item">
                <div class="text-xs font-semibold text-dorado">ðŸ‡µðŸ‡ª Lima</div>
                <div class="text-xs text-texto-secundario">--:-- --</div>
            </div>
            <div class="timezone-item">
                <div class="text-xs font-semibold text-dorado">ðŸ‡¨ðŸ‡´ BogotÃ¡</div>
                <div class="text-xs text-texto-secundario">--:-- --</div>
            </div>
        </div>

        <!-- Contador de Tiempo -->
        <div class="countdown" id="countdown-timer">
            <div class="time-unit" id="hours-unit" style="display: none;">
                <span id="hours">00</span>
                <span>horas</span>
            </div>
            <div class="time-unit">
                <span id="minutes">00</span>
                <span>minutos</span>
            </div>
            <div class="time-unit">
                <span id="seconds">00</span>
                <span>segundos</span>
            </div>
        </div>

        <!-- Audio y Controles -->
        <div class="flex flex-col items-center">
            <audio id="background-music" preload="metadata" autoplay loop>
                <source src="assets/audio/sientes-dudas-al-empezar.mp3" type="audio/mpeg">
                Tu navegador no soporta el elemento de audio.
            </audio>

            <button id="play-pause-btn" class="btn-play mt-4" title="Controlar mÃºsica de espera" style="display: none;">
                <i id="play-pause-icon" class="fas fa-pause text-2xl"></i>
            </button>
            
            <p id="message" class="status-message mt-4">Inicializando sala de espera...</p>
            
            <!-- Controles de volumen -->
            <div class="flex items-center justify-center mt-4 gap-3">
                <button id="volume-down" class="volume-btn">
                    <i class="fas fa-volume-down text-sm"></i>
                </button>
                <div class="flex items-center gap-2">
                    <span class="text-xs status-message">ðŸ”‰</span>
                    <div class="volume-bar-container">
                        <div class="volume-bar">
                            <div id="volume-fill" class="volume-fill"></div>
                        </div>
                    </div>
                    <span class="text-xs status-message">ðŸ”Š</span>
                </div>
                <button id="volume-up" class="volume-btn">
                    <i class="fas fa-volume-up text-sm"></i>
                </button>
                <button id="mute-btn" class="volume-btn ml-2">
                    <i id="mute-icon" class="fas fa-volume-up text-sm"></i>
                </button>
            </div>
            
            <p class="text-xs status-message mt-2 opacity-75">
                ðŸŽµ MÃºsica de espera automÃ¡tica â€¢ Controles de volumen disponibles
            </p>
        </div>
    </div>

    <!-- Scripts -->
    <script src="assets/js/waiting-room.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // FunciÃ³n para obtener parÃ¡metros de la URL
                const getUrlParams = () => {
                    const params = new URLSearchParams(window.location.search);
                    return {
                        meeting: params.get('meeting') || null,
                        date: params.get('date') || null,
                        time: params.get('time') || null,
                        url: params.get('url') || null,
                        title: params.get('title') || null
                    };
                };

                // Obtener configuraciÃ³n de la reuniÃ³n
                const getMeetingConfig = async (params) => {
                    // Si se pasan parÃ¡metros directos en la URL
                    if (params.date && params.time && params.url) {
                        return {
                            title: params.title || 'ReuniÃ³n en Vivo',
                            date: params.date,
                            time: params.time,
                            meetingUrl: params.url,
                            timezone: 'America/Montevideo'
                        };
                    }

                    // Si se especifica un meeting ID, intentar cargar desde config
                    if (params.meeting) {
                        try {
                            const response = await fetch('assets/config/meetings.json');
                            const config = await response.json();
                            
                            if (config.meetings && config.meetings[params.meeting]) {
                                return config.meetings[params.meeting];
                            } else {
                                console.warn(`ReuniÃ³n "${params.meeting}" no encontrada en la configuraciÃ³n`);
                            }
                        } catch (error) {
                            console.warn('Error cargando configuraciÃ³n de reuniones:', error);
                        }
                    }

                    // ConfiguraciÃ³n por defecto (reuniÃ³n de ejemplo para hoy a las 17:00)
                    const today = new Date();
                    const todayStr = today.toISOString().split('T')[0]; // YYYY-MM-DD
                    
                    return {
                        title: 'ReuniÃ³n de Ejemplo',
                        date: todayStr,
                        time: '17:00',
                        meetingUrl: 'https://meet.google.com/ihf-paiw-baf',
                        timezone: 'America/Montevideo'
                    };
                };

                // Obtener parÃ¡metros y configuraciÃ³n
                const urlParams = getUrlParams();
                const meetingConfig = await getMeetingConfig(urlParams);
                
                console.log('ConfiguraciÃ³n de reuniÃ³n cargada:', meetingConfig);

                // Actualizar tÃ­tulo si estÃ¡ disponible
                if (meetingConfig.title) {
                    const titleEl = document.getElementById('meeting-title');
                    if (titleEl) {
                        titleEl.textContent = `Sala de Espera - ${meetingConfig.title}`;
                    }
                }

                // Actualizar fecha mostrada
                const dateEl = document.getElementById('meeting-date');
                if (dateEl && meetingConfig.date && meetingConfig.time) {
                    const meetingDate = new Date(`${meetingConfig.date}T${meetingConfig.time}:00`);
                    const dateStr = meetingDate.toLocaleDateString('es-ES', {
                        weekday: 'long',
                        year: 'numeric',
                        month: 'long',
                        day: 'numeric'
                    });
                    const timeStr = meetingDate.toLocaleTimeString('es-ES', {
                        hour: '2-digit',
                        minute: '2-digit',
                        hour12: true
                    });
                    dateEl.textContent = `ðŸ“… ${dateStr} Â· ${timeStr}`;
                }

                // Inicializar la sala de espera
                window.waitingRoom = new WaitingRoom(meetingConfig);
                
                // Exponer mÃ©todos Ãºtiles globalmente para debugging/testing
                window.updateMeeting = (newConfig) => {
                    if (window.waitingRoom) {
                        window.waitingRoom.updateConfig(newConfig);
                    }
                };

                window.getMeetingStatus = () => {
                    if (window.waitingRoom) {
                        return window.waitingRoom.getStatus();
                    }
                };

                console.log('Sala de espera inicializada correctamente');
                console.log('Comandos disponibles:', {
                    'window.getMeetingStatus()': 'Ver estado actual',
                    'window.updateMeeting({date: "2025-10-15", time: "13:00", meetingUrl: "https://..."})': 'Cambiar configuraciÃ³n'
                });
                
            } catch (error) {
                console.error('Error inicializando sala de espera:', error);
                
                // Mostrar mensaje de error en la interfaz
                const messageEl = document.getElementById('message');
                if (messageEl) {
                    messageEl.textContent = 'Error al inicializar la sala. Revisa la configuraciÃ³n.';
                    messageEl.className = 'status-message critical';
                }
            }
        });
    </script>
</body>
</html>